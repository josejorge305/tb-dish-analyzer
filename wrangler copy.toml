name = "tb-dish-processor"
main = "index.js"
account_id = "68cbbc868956bf7166613432aee13dec"
compatibility_date = "2024-10-01"

# --- D1 (default env) ---
[[d1_databases]]
binding = "D1_DB"
database_name = "tb-database"
database_id = "055f6987-4353-4752-a4c5-24525e2f5cbb"

# --- KV (default env) ---
# Binding name must be LEXICON_CACHE (matches code)
[[kv_namespaces]]
binding = "LEXICON_CACHE"
id = "c4323f68f6984853b7ec2b2d77bdc57e"

# --- R2 (default env) ---
[[r2_buckets]]
binding = "R2_BUCKET"
bucket_name = "tb-analysis-cache"

# --- QUEUE CONSUMER (default env) ---
[[queues.consumers]]
queue = "tb-dish-analysis-queue"
max_batch_size = 1
max_batch_timeout = 5

# --- QUEUE PRODUCER (default env) ---
[[queues.producers]]
binding = "ANALYSIS_QUEUE"
queue = "tb-dish-analysis-queue"

# ================= PRODUCTION ENV =================
[env.production]
# optional but helpful to distinguish deployment name
name = "tb-dish-processor-production"

# --- Vars (our two dials live here) ---
[env.production.vars]
FALLBACK_TRIGGER_UNDER = "50"   # use fallback if shard entries < 50
HITS_LIMIT = "25"               # keep only top 25 ingredient hits

# --- D1 (production) ---
[[env.production.d1_databases]]
binding = "D1_DB"
database_name = "tb-database"
database_id = "055f6987-4353-4752-a4c5-24525e2f5cbb"

# --- KV (production) ---
[[env.production.kv_namespaces]]
binding = "LEXICON_CACHE"
id = "c4323f68f6984853b7ec2b2d77bdc57e"

# --- R2 (production) ---
[[env.production.r2_buckets]]
binding = "R2_BUCKET"
bucket_name = "tb-analysis-cache"

# --- QUEUE CONSUMER (production) ---
[[env.production.queues.consumers]]
queue = "tb-dish-analysis-queue"
max_batch_size = 1
max_batch_timeout = 5

# --- QUEUE PRODUCER (production) ---
[[env.production.queues.producers]]
binding = "ANALYSIS_QUEUE"
queue = "tb-dish-analysis-queue"
