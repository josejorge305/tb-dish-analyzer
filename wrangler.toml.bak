name = "tb-dish-processor"
main = "index.js"
account_id = "68cbbc868956bf7166613432aee13dec"
compatibility_date = "2024-10-01"

# --- D1 (default env) ---
[[d1_databases]]
binding = "D1_DB"
database_name = "tb-database"
database_id = "055f6987-4353-4752-a4c5-24525e2f5cbb"

# --- KV (default env) ---
# Binding name must be LEXICON_CACHE (matches code)
[[kv_namespaces]]
binding = "LEXICON_CACHE"
id = "c4323f68f6984853b7ec2b2d77bdc57e"

# Dedicated menus cache (dev)
[[kv_namespaces]]
binding = "MENUS_CACHE"
id = "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" # (dev)

# --- R2 (default env) ---
[[r2_buckets]]
binding = "R2_BUCKET"
bucket_name = "tb-analysis-cache"

# --- QUEUE CONSUMER (default env) ---
[[queues.consumers]]
queue = "tb-dish-analysis-queue"
max_batch_size = 1
max_batch_timeout = 5

# --- QUEUE PRODUCER (default env) ---
[[queues.producers]]
binding = "ANALYSIS_QUEUE"
queue = "tb-dish-analysis-queue"

# ================= PRODUCTION ENV =================
[env.production]
# helpful label in dashboard
name = "tb-dish-processor-production"

# --- Vars (our dials + explicit RapidAPI host) ---
[env.production.vars]
FALLBACK_TRIGGER_UNDER = "50"
HITS_LIMIT = "25"
UBER_RAPID_HOST = "uber-eats-scraper-api.p.rapidapi.com"
RAPIDAPI_HOST   = "uber-eats-scraper-api.p.rapidapi.com"
LEXICON_API_URL = "https://tummy-lexicon-api.onrender.com"

# âœ… Provider order configuration (upper + lower aliases)
PROVIDERS_RECIPE = "spoonacular,edamam,openai"
provider_recipe  = "spoonacular,edamam,openai"
PROVIDERS_PARSE  = "zestful,openai"
provider_parse   = "zestful,openai"
ZESTFUL_RAPID_HOST = "zestful.p.rapidapi.com"
ZESTFUL_DAILY_CAP = "5500"

# NOTE: Keep API keys as Secrets:
#   wrangler secret put RAPIDAPI_KEY
#   wrangler secret put LEXICON_API_URL
#   wrangler secret put LEXICON_API_KEY
#   wrangler secret put SPOONACULAR_API_KEY
#   wrangler secret put ZESTFUL_RAPID_KEY
#   wrangler secret put EDAMAM_APP_ID
#   wrangler secret put EDAMAM_APP_KEY

# --- D1 (production) ---
[[env.production.d1_databases]]
binding = "D1_DB"
database_name = "tb-database"
database_id = "055f6987-4353-4752-a4c5-24525e2f5cbb"

# --- KV (production) ---
[[env.production.kv_namespaces]]
binding = "LEXICON_CACHE"
id = "c4323f68f6984853b7ec2b2d77bdc57e"

[[env.production.kv_namespaces]]
binding = "MENUS_CACHE"
id = "f363caa0518e46daa062f511c9d50c75"

# --- R2 (production) ---
[[env.production.r2_buckets]]
binding = "R2_BUCKET"
bucket_name = "tb-analysis-cache"

# --- QUEUE CONSUMER (production) ---
[[env.production.queues.consumers]]
queue = "tb-dish-analysis-queue"
max_batch_size = 1
max_batch_timeout = 5

# --- QUEUE PRODUCER (production) ---
[[env.production.queues.producers]]
binding = "ANALYSIS_QUEUE"
queue = "tb-dish-analysis-queue"

[env.production.vars]
USDA_FDC_API_KEY = "TlcauMZsVm9LZJEzfJlgKS73RLfLt9Ob7trCto3Q"
USDA_FDC_HOST = "api.nal.usda.gov"


[env.production.vars]
USDA_FDC_API_KEY = "TlcauMZsVm9LZJEzfJlgKS73RLfLt9Ob7trCto3Q"
USDA_FDC_HOST = "api.nal.usda.gov"

